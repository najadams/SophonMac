import{a4 as y,j as e,r as l,b7 as s,B as h,Y as M,T as n,G as c,F as f,H as v,J as S,c as d,aG as re,aH as ae,aI as oe,aJ as ce,ag as T,b8 as ie,b9 as A,ba as $,bb as G,at as H,b as W,bc as U}from"./index-DKVd45z4.js";import{R as le}from"./Refresh-D67g723Y.js";import{S as de,a as B}from"./Settings-DkAUG6Tw.js";import{C as he,E as xe}from"./Error-aBKScyfC.js";const ue=y(e.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),je=y(e.jsx("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2zM4 6h16v10H4z"}),"Computer"),me=y(e.jsx("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),ge=y(e.jsx("path",{d:"M6 6h12v12H6z"}),"Stop"),ye=y(e.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),fe=y(e.jsx("path",{d:"m1 9 2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9m8 8 3 3 3-3c-1.65-1.66-4.34-1.66-6 0m-4-4 2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13"}),"Wifi"),ve=y(e.jsx("path",{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7zm-4 4c-1.29-1.29-2.84-2.13-4.49-2.56l3.53 3.53zM2 3.05 5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24C7.81 10.89 6.27 11.73 5 13v.01L6.99 15c1.36-1.36 3.14-2.04 4.92-2.06L18.98 20l1.27-1.26L3.29 1.79zM9 17l3 3 3-3c-1.65-1.66-4.34-1.66-6 0"}),"WifiOff"),De=()=>{const[o,r]=l.useState({isOnline:!1,isMaster:!1,connectedPeers:[],lastSync:null}),[x,u]=l.useState([]),[a,m]=l.useState([]),[p,j]=l.useState(null),[J,I]=l.useState(!0),[V,C]=l.useState(!1),[Y,L]=l.useState(!1),[q,b]=l.useState(null),[w,k]=l.useState(!1);l.useEffect(()=>(z(),K(),()=>{Q()}),[]);const z=async()=>{try{I(!0);const t=s.getNetworkStatus();r(t);const i=await s.getConnectedPeers();u(i);const g=await s.getSyncConflicts();m(g);const D=await s.getNetworkConfig();j(D)}catch(t){console.error("Failed to initialize network manager:",t)}finally{I(!1)}},K=()=>{s.on("networkStatusChanged",N),s.on("peerConnected",F),s.on("peerDisconnected",O),s.on("syncComplete",P),s.on("syncConflict",R)},Q=()=>{s.off("networkStatusChanged",N),s.off("peerConnected",F),s.off("peerDisconnected",O),s.off("syncComplete",P),s.off("syncConflict",R)},N=t=>{r(t)},F=t=>{u(i=>[...i.filter(g=>g.id!==t.id),t])},O=t=>{u(i=>i.filter(g=>g.id!==t))},P=t=>{k(!1),r(i=>({...i,lastSync:new Date().toISOString()}))},R=t=>{m(i=>[...i,t])},X=async()=>{try{k(!0),await s.forceSync()}catch(t){console.error("Failed to force sync:",t),k(!1)}},Z=async()=>{try{await s.forceMaster(),await s.updateNetworkStatus()}catch(t){console.error("Failed to force master role:",t)}},_=async()=>{try{await s.forceSlave(),await s.updateNetworkStatus()}catch(t){console.error("Failed to force slave role:",t)}},ee=async t=>{try{await s.updateNetworkConfig(t),j(t),C(!1)}catch(i){console.error("Failed to update network config:",i)}},te=async()=>{try{b(null),L(!0);const t=await s.runDiagnostics();b(t)}catch(t){console.error("Failed to run diagnostics:",t),b({error:t.message})}},E=async(t,i)=>{try{await s.resolveSyncConflict(t,i),m(g=>g.filter(D=>D.id!==t))}catch(g){console.error("Failed to resolve conflict:",g)}},se=()=>o.isOnline?a.length>0?"warning":"success":"error",ne=()=>o.isOnline?a.length>0?e.jsx(ie,{}):e.jsx(fe,{}):e.jsx(ve,{});return J?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(M,{})}):e.jsxs(h,{p:3,children:[e.jsx(n,{variant:"h4",gutterBottom:!0,children:"Network Management"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(f,{children:e.jsxs(v,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:2,children:[ne(),e.jsx(n,{variant:"h6",ml:1,children:"Network Status"}),e.jsx(S,{label:o.isOnline?"Online":"Offline",color:se(),size:"small",sx:{ml:"auto"}})]}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"body2",color:"textSecondary",children:"Role"}),e.jsx(n,{variant:"body1",children:o.isMaster?"Master":"Slave"})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"body2",color:"textSecondary",children:"Connected Peers"}),e.jsx(n,{variant:"body1",children:x.length})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(n,{variant:"body2",color:"textSecondary",children:"Last Sync"}),e.jsx(n,{variant:"body1",children:o.lastSync?new Date(o.lastSync).toLocaleString():"Never"})]})]}),e.jsxs(h,{mt:2,children:[e.jsx(d,{variant:"contained",startIcon:w?e.jsx(M,{size:16}):e.jsx(ye,{}),onClick:X,disabled:w||!o.isOnline,sx:{mr:1},children:w?"Syncing...":"Force Sync"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:z,children:"Refresh"})]})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(f,{children:e.jsxs(v,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Role Management"}),e.jsxs(n,{variant:"body2",color:"textSecondary",mb:2,children:["Current role: ",o.isMaster?"Master":"Slave"]}),e.jsxs(h,{children:[e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(me,{}),onClick:Z,disabled:o.isMaster,sx:{mr:1,mb:1},children:"Force Master"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:_,disabled:!o.isMaster,sx:{mb:1},children:"Force Slave"})]}),e.jsx(n,{variant:"caption",display:"block",mt:1,children:"Use with caution. Forcing roles can cause sync conflicts."})]})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(f,{children:e.jsxs(v,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,children:["Connected Peers (",x.length,")"]}),x.length===0?e.jsx(n,{variant:"body2",color:"textSecondary",children:"No peers connected"}):e.jsx(re,{children:x.map(t=>e.jsxs(ae,{children:[e.jsx(oe,{children:e.jsx(je,{})}),e.jsx(ce,{primary:t.name||t.id,secondary:`${t.ip}:${t.port} - ${t.role} - Last seen: ${new Date(t.lastSeen).toLocaleString()}`}),e.jsx(S,{label:t.status,color:t.status==="connected"?"success":"default",size:"small"})]},t.id))})]})})}),a.length>0&&e.jsx(c,{item:!0,xs:12,children:e.jsx(f,{children:e.jsxs(v,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,color:"warning.main",children:["Sync Conflicts (",a.length,")"]}),a.map(t=>e.jsxs(T,{severity:"warning",sx:{mb:1},action:e.jsxs(h,{children:[e.jsx(d,{size:"small",onClick:()=>E(t.id,"local"),children:"Use Local"}),e.jsx(d,{size:"small",onClick:()=>E(t.id,"remote"),children:"Use Remote"})]}),children:[e.jsxs(n,{variant:"body2",children:[t.table," - ",t.operation," - ",t.recordId]}),e.jsx(n,{variant:"caption",children:new Date(t.timestamp).toLocaleString()})]},t.id))]})})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(h,{display:"flex",gap:2,children:[e.jsx(d,{variant:"outlined",startIcon:e.jsx(de,{}),onClick:()=>C(!0),children:"Network Settings"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(ue,{}),onClick:te,children:"Run Diagnostics"})]})})]}),e.jsx(Se,{open:V,config:p,onClose:()=>C(!1),onSave:ee}),e.jsx(pe,{open:Y,result:q,onClose:()=>L(!1)})]})},Se=({open:o,config:r,onClose:x,onSave:u})=>{const[a,m]=l.useState({autoDiscovery:!0,syncInterval:30,maxPeers:10,enableEncryption:!0,...r});l.useEffect(()=>{r&&m({...a,...r})},[r]);const p=()=>{u(a)};return e.jsxs(A,{open:o,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Network Configuration"}),e.jsx(G,{children:e.jsxs(h,{mt:2,children:[e.jsx(H,{control:e.jsx(B,{checked:a.autoDiscovery,onChange:j=>m({...a,autoDiscovery:j.target.checked})}),label:"Auto Discovery"}),e.jsx(W,{fullWidth:!0,label:"Sync Interval (seconds)",type:"number",value:a.syncInterval,onChange:j=>m({...a,syncInterval:parseInt(j.target.value)}),margin:"normal"}),e.jsx(W,{fullWidth:!0,label:"Max Peers",type:"number",value:a.maxPeers,onChange:j=>m({...a,maxPeers:parseInt(j.target.value)}),margin:"normal"}),e.jsx(H,{control:e.jsx(B,{checked:a.enableEncryption,onChange:j=>m({...a,enableEncryption:j.target.checked})}),label:"Enable Encryption"})]})}),e.jsxs(U,{children:[e.jsx(d,{onClick:x,children:"Cancel"}),e.jsx(d,{onClick:p,variant:"contained",children:"Save"})]})]})},pe=({open:o,result:r,onClose:x})=>e.jsxs(A,{open:o,onClose:x,maxWidth:"md",fullWidth:!0,children:[e.jsx($,{children:"Network Diagnostics"}),e.jsx(G,{children:r?r.error?e.jsx(T,{severity:"error",children:r.error}):e.jsxs(h,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Diagnostic Results"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",children:"Network Status"}),e.jsx(S,{label:r.networkStatus?"Online":"Offline",color:r.networkStatus?"success":"error",size:"small"})]}),e.jsxs(c,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",children:"Database Status"}),e.jsx(S,{label:r.databaseStatus?"Connected":"Disconnected",color:r.databaseStatus?"success":"error",size:"small"})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(n,{variant:"subtitle2",children:"Peer Connectivity"}),r.peerTests&&r.peerTests.length>0?r.peerTests.map((u,a)=>e.jsxs(h,{display:"flex",alignItems:"center",mt:1,children:[u.success?e.jsx(he,{color:"success"}):e.jsx(xe,{color:"error"}),e.jsxs(n,{ml:1,children:[u.peer," - ",u.success?"Connected":u.error]})]},a)):e.jsx(n,{variant:"body2",color:"textSecondary",children:"No peers to test"})]})]})]}):e.jsx(h,{display:"flex",justifyContent:"center",p:3,children:e.jsx(M,{})})}),e.jsx(U,{children:e.jsx(d,{onClick:x,children:"Close"})})]});export{De as default};
