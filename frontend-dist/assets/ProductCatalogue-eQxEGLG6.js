import{U as X,r as l,y as De,a1 as je,j as e,ag as pe,ax as he,ar as me,b as d,bq as xe,c as S,Y as O,b9 as Y,ba as _,bb as G,bm as J,bc as K,bn as W,br as Ee,aC as Ie,a3 as F,bs as Oe,bp as Fe,E as Se,B as q,T as R,aO as Re,bh as Qe,a2 as Be,z as ge,aE as Le,aF as ye,a0 as Me}from"./index-GTE1N4Ws.js";import{A as Ue,P as ze,T as He}from"./TableCreater-DKyqnnM7.js";import{F as Ye,a as _e,b as w,c as Ge}from"./formik.esm-gcJT4q9S.js";import{A as Pe}from"./Autocomplete-CB6kXBb8.js";import"./InputAdornment-C5JJzB5e.js";import"./LinearProgress-CkWFVjTZ.js";import"./Snackbar-DB0jCccG.js";import"./useMutation-psyMo_QX.js";import"./SearchField-D7IF_go7.js";import"./usePreviousProps-yVRdJcfX.js";const Je=he().shape({products:Ee().of(he().shape({name:Ie().required("Product name is required"),quantity:W().required("Quantity is required").min(1,"Quantity must be at least 1"),costPrice:W().required("Cost Price is required"),salesPrice:W().required("Sales Price is required")})),total:W().required(),amountPaid:W().required("Amount Paid should not be empty"),discount:W().min(0,"Discount cannot be negative")}),Ke=({Products:u,handleProductUpdate:g,setProducts:y})=>{const P=X(t=>t.userState.currentUser).id,C=X(t=>t.companyState.data.id),[E,f]=l.useState(null),[Q,A]=l.useState(!1),[Z,Ze]=l.useState(!1),[we,V]=l.useState(!1),[ee,B]=l.useState(!1),te=De("(max-width:600px)"),[re,ae]=l.useState(!1),[Ce,se]=l.useState([{id:1,name:"<<<< Add New Supplier >>>>"}]),[L,ve]=l.useState([{id:1,name:"<<<< Add New Product >>>>"},...u]),[oe,T]=l.useState(!1),[Ne,I]=l.useState(!1),[b,ne]=l.useState({name:"",salesPrice:"",costPrice:"",onhand:""}),[M,ie]=l.useState(""),[U,le]=l.useState(""),[ce,de]=l.useState(""),[k,Ae]=l.useState({}),Te=async(t,p,r)=>{const h=t.products.reduce((s,a)=>s+(a==null?void 0:a.totalPrice),0);t.total=h;const D=t.total-t.amountPaid-t.discount;try{if(!t.amountPaid)f("Amount Paid Should not be Empty!");else{ae(!0),p(!0),await F.restock({...t,balance:D,workerId:P},C);const s=Oe(L,t);g&&g(),A(!0),setTimeout(()=>{r()},1e3)}}catch(s){console.log(s),f(s||s.toString())}finally{p(!1),ae(!1)}},z=t=>{const{name:p,value:r}=t.target;ne(h=>({...h,[p]:r}))},ue=async()=>{try{if(!Fe(b,Ae,!1))return;B(!0);const p=b.name.trim().toLowerCase();console.log("first",b);const r=await F.addProduct({...b,name:p,companyId:C});if(console.log("coco"),!r||!r.data){const s=typeof r=="string"?r:(r==null?void 0:r.message)||"Failed to add product";throw new Error(s)}const h=r.data;ve(s=>{const a=s.filter(n=>n.name!=="<<<< Add New Product >>>>");return[{id:1,name:"<<<< Add New Product >>>>"},...a,{name:me(h.name),salesPrice:h.salesPrice||0,onhand:h.onhand||0}].sort((n,m)=>n.name.localeCompare(m.name))});const D={...b,onhand:0};g(b),T(!1),B(!1),ne({name:"",salesPrice:"",costPrice:"",onhand:""})}catch(t){B(!1),console.log("error from catch in submit product"),f(t.message||"Failed to add new product")}},ke=async()=>{try{V(!0);const t=await F.addSupplier({companyId:C,supplierName:M,companyName:U,contact:ce}),p=t==null?void 0:t.data,r=`${U} - ${M}`;se(h=>["<<<< Add New Supplier >>>>",...h.filter(D=>D!=="<<<< Add New Supplier >>>>"),r]),I(!1),ie(""),le(""),de("")}catch(t){V(!1),console.log("Error adding supplier:",t),f("Failed to add new Supplier")}},{data:H,isLoading:Ve,isError:et,error:tt}=je(["suppliers",C],()=>F.fetchSuppliersNames(C),{enabled:!!C,onError:t=>{console.error("Error fetching suppliers:",t)}});return l.useEffect(()=>{H&&se(["<<<< Add New Supplier >>>>",...H])},[H]),e.jsxs("div",{children:[e.jsxs("div",{className:"heading",style:{background:"none"},children:[e.jsx("h1",{style:{fontWeight:200},children:"Receive Items / Restock "}),Q&&e.jsx(pe,{className:"alert",variant:"filled",severity:"success",onClose:()=>A(!1),children:"Restock successful"})]}),E&&e.jsx(pe,{className:"alert",variant:"filled",severity:"error",onClose:()=>f(""),children:E.toString()}),e.jsx(Ye,{initialValues:{supplierName:"",products:[{name:"",quantity:"",totalPrice:0,costPrice:0,salesPrice:0}],total:0,amountPaid:"",discount:0},validationSchema:Je,onSubmit:(t,{setSubmitting:p,resetForm:r})=>{Te(t,p,r)},children:({values:t,submitForm:p,setFieldValue:r,isSubmitting:h,resetForm:D})=>e.jsxs(_e,{className:"form",style:{margin:10},children:[e.jsx(w,{name:"supplierName",children:({field:s,form:a})=>{const n=!!(a.errors.supplierName&&a.touched.supplierName);return e.jsx(Pe,{...s,options:me(Ce),autoHighlight:!0,value:s.value,onChange:(m,$)=>{$==="<<<< Add New Supplier >>>>"?(I(!0),a.setFieldValue(s.name,"")):a.setFieldValue(s.name,$||"")},renderInput:m=>e.jsx(d,{...m,style:{paddingBottom:10},label:"Supplier Name",fullWidth:!0,error:n,helperText:n?a.errors.supplierName:""})})}}),e.jsx(Ge,{name:"products",children:({push:s,remove:a})=>{var n,m;return e.jsxs("div",{style:{display:"flex",gap:10,flexDirection:"column"},children:[t.products.map(($,i)=>{const $e=L.map(c=>(c==null?void 0:c.name)||"");return e.jsxs("div",{style:{display:"flex",flex:1,gap:10,flexWrap:"wrap",flexDirection:te?"column":"row"},children:[e.jsxs("div",{style:{display:"flex",flex:1,flexDirection:"row",gap:"1rem"},children:[e.jsx(w,{name:`products.${i}.name`,children:({field:c,form:v})=>e.jsx(Pe,{options:$e,autoHighlight:!0,value:$.name,onChange:(j,N)=>{if(N==="<<<< Add New Product >>>>")T(!0),v.setFieldValue(c.name,"");else{v.setFieldValue(c.name,N);const x=L.find(qe=>qe.name===N),We=$.quantity*(x==null?void 0:x.costPrice);r(`products.${i}.totalPrice`,We),r(`products.${i}.costPrice`,(x==null?void 0:x.costPrice)||0),r(`products.${i}.salesPrice`,(x==null?void 0:x.salesPrice)||0)}},renderInput:j=>e.jsx(d,{style:{flex:1,width:te?150:350},...j,label:"Product Name",fullWidth:!0}),autoSelect:!0})}),e.jsx(w,{as:d,fullWidth:!0,style:{minWidth:120},name:`products.${i}.quantity`,label:"Quantity",type:"number",onChange:c=>{const v=parseInt(c.target.value);r(`products.${i}.quantity`,v);const j=t.products[i].costPrice||0,N=v*j;r(`products.${i}.totalPrice`,N)}})]}),e.jsxs("div",{style:{display:"flex",flex:1,gap:10},children:[e.jsx(w,{name:`products.${i}.costPrice`,children:({field:c})=>e.jsx(d,{...c,label:"Cost Price",type:"number",style:{minWidth:120},fullWidth:!0,InputProps:{style:{textAlign:"right"}},onChange:v=>{const j=parseFloat(v.target.value);r(`products.${i}.costPrice`,j);const x=(t.products[i].quantity||0)*j;r(`products.${i}.totalPrice`,x)}})}),e.jsx(w,{name:`products.${i}.salesPrice`,children:({field:c,form:v})=>e.jsx(d,{...c,label:"Sales Price",type:"number",style:{minWidth:120},fullWidth:!0,InputProps:{style:{textAlign:"right"}},onChange:j=>{const N=parseFloat(j.target.value);r(`products.${i}.salesPrice`,N)}})}),e.jsx(w,{name:`products.${i}.totalPrice`,children:({field:c})=>e.jsx(xe,{value:$.totalPrice,label:"Total Price",readOnly:!0,inputProps:{style:{textAlign:"right"}}})}),e.jsx(S,{style:{height:"80%",marginTop:10},variant:"contained",color:"error",onClick:()=>a(i),children:"Remove"})]})]},i)}),e.jsx(S,{variant:"contained",color:"secondary",type:"button",onClick:()=>{s({name:"",quantity:"",totalPrice:0,costPrice:0,salesPrice:0})},disabled:((n=t.products)==null?void 0:n.length)>0&&!Object.values(t.products[((m=t.products)==null?void 0:m.length)-1]).every(Boolean),children:"Add Product"})]})}}),e.jsx(w,{name:"total",children:({field:s})=>e.jsx(xe,{value:t.products.reduce((a,n)=>a+(n==null?void 0:n.totalPrice),0),label:"Total",readOnly:!0,inputProps:{style:{textAlign:"right"}}})}),e.jsx(w,{name:"amountPaid",children:({field:s,form:a})=>{const n=!!(a.errors.amountPaid&&a.touched.amountPaid);return e.jsx(d,{...s,label:"Amount Paid",type:"number",placeholder:"Amount Paid",fullWidth:!0,error:n,helperText:n?a.errors.amountPaid:"",onChange:m=>{r("amountPaid",m.target.value)}})}}),e.jsx(w,{name:"discount",children:({field:s,form:a})=>{const n=!!(a.errors.discount&&a.touched.discount);return e.jsx(d,{...s,label:"Discount",type:"number",placeholder:"Discount",fullWidth:!0,error:n,helperText:n?a.errors.discount:"",onChange:m=>{r("discount",m.target.value)}})}}),e.jsx("div",{className:"bottom_left",children:e.jsx(S,{variant:"contained",color:"primary",onClick:()=>{p()},disabled:re||h,children:re?e.jsx(O,{}):"Restock"})})]})}),e.jsxs(Y,{open:oe,onClose:()=>T(!1),children:[e.jsx(_,{children:"Add New Product"}),e.jsxs(G,{children:[e.jsx(J,{children:"Please enter the details of the new product."}),e.jsxs(Y,{open:oe,onClose:()=>T(!1),children:[e.jsx(_,{children:"Add New Product"}),e.jsxs(G,{children:[e.jsx(J,{children:"Please enter the details of the new product."}),e.jsx(d,{autoFocus:!0,margin:"dense",label:"Product Name",name:"name",fullWidth:!0,required:!0,value:b.name,onChange:z,error:!!k.name,helperText:k.name}),e.jsx(d,{margin:"dense",label:"Sales Price",type:"number",name:"salesPrice",fullWidth:!0,required:!0,value:b.salesPrice,onChange:z,error:!!k.salesPrice,helperText:k.salesPrice}),e.jsx(d,{margin:"dense",label:"Cost Price",type:"number",name:"costPrice",fullWidth:!0,required:!0,value:b.costPrice,onChange:z,error:!!k.costPrice,helperText:k.costPrice})]}),e.jsxs(K,{children:[e.jsx(S,{onClick:()=>T(!1),color:"primary",children:"Cancel"}),ee?e.jsx(O,{}):e.jsx(S,{onClick:ue,color:"primary",children:"Add Product"})]})]})]}),e.jsxs(K,{children:[e.jsx(S,{onClick:()=>T(!1),color:"primary",children:"Cancel"}),ee?e.jsx(O,{}):e.jsx(S,{onClick:ue,color:"primary",children:"Add Product"})]})]}),e.jsxs(Y,{open:Ne,onClose:()=>I(!1),children:[e.jsx(_,{children:"Add Supplier"}),e.jsxs(G,{children:[e.jsx(J,{children:"Details of the new Suppler."}),e.jsx(d,{autoFocus:!0,margin:"dense",label:"Supplier's Company",fullWidth:!0,value:U,onChange:t=>le(t.target.value)}),e.jsx(d,{margin:"dense",label:"Suppliers Name",fullWidth:!0,value:M,onChange:t=>ie(t.target.value)}),e.jsx(d,{margin:"dense",label:"Contact",fullWidth:!0,type:"number",value:ce,onChange:t=>de(t.target.value)})]}),e.jsxs(K,{children:[e.jsx(S,{onClick:()=>I(!1),color:"primary",children:"Cancel"}),we?e.jsx(O,{size:24}):e.jsx(S,{onClick:ke,color:"primary",children:"Add Supplier"})]})]})]})},Xe=async u=>{try{return(await Me.get(`/api/products/${u}`)).data.products.map((o,P)=>({id:o.id,index:P+1,name:o.name,category:o.category,baseUnit:o.baseUnit,unitConversions:o.unitConversions||[],costPrice:o.costPrice,salesPrice:o.salesPrice,onhand:o.onhand,reorderPoint:o.reorderPoint,minimumStock:o.minimumStock,description:o.description,sku:o.sku,barcode:o.barcode}))}catch{throw new Error("Failed to fetch products")}},fe=u=>{const{children:g,value:y,index:o,...P}=u;return e.jsx(Se.div,{role:"tabpanel",hidden:y!==o,id:`full-width-tabpanel-${o}`,"aria-labelledby":`full-width-tab-${o}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},...P,children:y===o&&e.jsx(q,{sx:{p:0},children:e.jsx(R,{children:g})})})},be=u=>({id:`full-width-tab-${u}`,"aria-controls":`full-width-tabpanel-${u}`}),pt=()=>{const[u,g]=Re.useState(0),y=X(A=>A.companyState.data.id),o=Qe(),{data:P=[],isLoading:C,isError:E}=je(["api/products",y],()=>Xe(y),{staleTime:1e3*30,cacheTime:1e3*60*5}),f=A=>{o.invalidateQueries(["api/products",y])},Q=(A,Z)=>{g(Z)};return C?e.jsx(Be,{}):E?e.jsx("div",{children:"Error fetching data"}):e.jsxs(Se.div,{className:"page",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs(q,{className:"heading",sx:{display:"flex",flexDirection:"column",gap:3,mb:4,p:0,borderRadius:"12px",backgroundColor:ge("#fff",.8),boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs(q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(R,{variant:"h4",sx:{fontWeight:300,color:"primary.main",letterSpacing:"0.5px"},children:"Products"}),e.jsx(Ue,{children:e.jsx(ze,{onProductUpdate:f})})]}),e.jsx(q,{sx:{width:"100%",maxWidth:"600px",mx:"auto","& .MuiTabs-root":{"& .MuiTab-root":{textTransform:"none",fontSize:"1rem",fontWeight:500,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)"}}}},children:e.jsxs(Le,{value:u,onChange:Q,indicatorColor:"secondary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example",children:[e.jsx(ye,{label:"Products",...be(0)}),e.jsx(ye,{label:"Receive inventory",...be(1)})]})})]}),e.jsxs(q,{className:"cotent",sx:{p:3,borderRadius:"12px",backgroundColor:ge("#fff",.8),boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx(fe,{value:u,index:0,children:P.length>0?e.jsx(He,{companyId:y,type:"products",data:P,onDataUpdate:f}):e.jsxs(q,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center",color:"text.secondary"},children:[e.jsx("img",{src:"/noInventory.jpg",alt:"No inventory available",style:{maxWidth:"100%",height:"auto",maxHeight:"200px",marginBottom:"16px"}}),e.jsx(R,{variant:"h5",sx:{mb:2},children:"No Products Yet"}),e.jsx(R,{variant:"body1",children:"Add your first product to get started"})]})}),e.jsx(fe,{value:u,index:1,children:e.jsx(Ke,{Products:P,handleProductUpdate:f})})]})]})};export{fe as TabPanel,be as allyProps,pt as default};
