import{i as fe,a as ge,j as e,aO as Re,Q as Ft,r as i,U as we,bh as Mt,bi as nt,s as L,a7 as w,I as De,ar as Y,ac as qe,bj as It,q as G,am as he,b5 as Ut,bk as st,E as xe,ak as ot,al as it,an as lt,a0 as ct,B as Ot,T as V,bl as Pe,aj as Dt,P as qt,b1 as _t,y as Je,ax as Lt,b as C,c as _,ah as At,ai as Wt,ab as Bt,Y as Xe,b9 as Fe,ba as Me,bb as ve,bm as Ce,bc as Ie,a2 as _e,aC as Ze,bn as Ue,a3 as pe,bo as zt,bp as Et,a1 as Qt,aE as Ht,aF as et}from"./index-CVowLR_r.js";import{P as ie}from"./index-Cmq9eoP0.js";import{d as Kt}from"./TableCreater-DAy_0DqI.js";import{R as dt,E as Vt}from"./Error-BMWdOoAV.js";import{Widgets as Yt}from"./Dashboard-Cyf9fNkG.js";import{S as Gt}from"./SearchField-7UroPVKX.js";import{allyProps as tt,TabPanel as at}from"./ProductCatalogue-BKT-B4QW.js";import{F as Jt,a as Xt,b as D,c as Zt}from"./formik.esm-DMAcCuh3.js";import{A as Oe}from"./Autocomplete-DmDR8qSz.js";import{S as ea}from"./Snackbar-Cz1MwB4l.js";import{d as ta}from"./CalendarToday-DJ0dY9a5.js";import"./InputAdornment-vzh5SJ0Z.js";import"./LinearProgress-CkR9Hjqq.js";import"./useMutation-FIspEjot.js";import"./VisibilityOff-BNM4AES3.js";import"./People-BCs58hzm.js";import"./Error-Dk37BwA0.js";import"./usePreviousProps-DJLcVbf3.js";var Le={},aa=fe;Object.defineProperty(Le,"__esModule",{value:!0});var ut=Le.default=void 0,ra=aa(ge()),na=e;ut=Le.default=(0,ra.default)((0,na.jsx)("path",{d:"M14.4 6 14 4H5v17h2v-7h5.6l.4 2h7V6z"}),"Flag");var Ae={},sa=fe;Object.defineProperty(Ae,"__esModule",{value:!0});var mt=Ae.default=void 0,oa=sa(ge()),ia=e;mt=Ae.default=(0,oa.default)((0,ia.jsx)("path",{d:"m14 6-1-2H5v17h2v-7h5l1 2h7V6zm4 8h-4l-1-2H7V6h5l1 2h5z"}),"OutlinedFlag");var We={},la=fe;Object.defineProperty(We,"__esModule",{value:!0});var pt=We.default=void 0,ca=la(ge()),da=e;pt=We.default=(0,ca.default)((0,da.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");L(w)(({theme:r})=>({[`&.${Pe.head}`]:{backgroundColor:"#1a237e",color:r.palette.primary.contrastText,fontSize:"16px",position:"sticky",top:0,zIndex:1},[`&.${Pe.body}`]:{fontSize:"14px"}}));const rt=L(he)(({theme:r,flagged:y})=>({"&:nth-of-type(odd)":{backgroundColor:y?"#ffebee":"#fff"},"&:last-child td, &:last-child th":{border:0},backgroundColor:y?"#ffebee":"inherit",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:y?"#ffebee":r.palette.action.hover,transform:"scale(1.001)"}})),ua=L(Ot)(({theme:r})=>({margin:1,background:"#f8f9fa",borderRadius:"8px",padding:"16px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"all 0.3s ease-in-out","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.1)"}})),ma=L(V)(({theme:r})=>({color:"#1a237e",fontWeight:600,marginBottom:"16px",paddingBottom:"8px",borderBottom:"2px solid #e3f2fd"}));function ht({row:r,onFlagChange:y,setValue:T}){const[N,J]=Re.useState(!1),B=Ft(),[A,j]=Re.useState(null),$=i.useRef(),[v,R]=i.useState(null),z=we(f=>f.companyState.data.id),ee=Mt(),S=f=>!f||isNaN(new Date(f).getTime())?"Invalid Date":new Date(f).toLocaleString(),b=f=>{j(f.currentTarget)},E=()=>{j(null)},m=()=>{E(),B(`/receipts/${r._id}`,{state:{row:r}})},Q=()=>{B(`/sales/${r._id}`,{state:{row:r}}),E(),T(1)},le=async()=>{var ae,re,ne,W;E();const f=!r.flagged,X=r.flagged;try{y(r._id,f);const p=await ct.patch(`/api/receipts/${r._id}/flag`,{flagged:f,companyId:z});console.log(`Receipt ${f?"flagged":"unflagged"} successfully:`,p.data),ee.invalidateQueries(["api/products",z])}catch(p){y(r._id,X),console.error("Failed to update the flag status:",p);const P=((re=(ae=p.response)==null?void 0:ae.data)==null?void 0:re.error)||((W=(ne=p.response)==null?void 0:ne.data)==null?void 0:W.message)||"Failed to update flag status";alert(`Error: ${P}`)}},te=()=>{R({customerName:`${r.customerName} - ${r.customerCompany}`,products:r.detail,total:r.total,balance:r.balance,discount:r.discount,amountPaid:r.amountPaid,date:S(r.date),workerName:r.workerusername?r.workerusername:r.workerName}),setTimeout(()=>{R(null)},2e3),j(null)};return e.jsxs(Re.Fragment,{children:[v&&e.jsx("div",{style:{display:"none"},children:e.jsx(dt,{ref:$,customerName:v.customerName,products:v.products,total:v.total,balance:v.balance,amountPaid:v.amountPaid,date:v.date,workerName:v.workerName,discount:v.discount})}),e.jsx(nt,{title:S(r.date),placement:"top",arrow:!0,children:e.jsxs(rt,{sx:{"& > *":{borderBottom:"unset"}},flagged:r.flagged,children:[e.jsx(w,{children:e.jsx(De,{"aria-label":"expand row",size:"small",onClick:()=>J(!N),sx:{transition:"transform 0.2s ease-in-out",transform:N?"rotate(180deg)":"rotate(0)"},children:e.jsx(pt,{})})}),e.jsx(w,{component:"th",scope:"row",style:{width:"30%"},children:Y(r.customerName)}),e.jsx(w,{align:"left",children:Y(r.workerName)}),e.jsx(w,{align:"right",children:qe(r.total)}),e.jsx(w,{align:"right",children:r.detail.length}),e.jsxs(w,{align:"right",children:[e.jsx(De,{"aria-label":"more options",size:"small",onClick:b,sx:{transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.1)"}},children:e.jsx(Kt,{})}),e.jsxs(It,{anchorEl:A,open:!!A,onClose:E,PaperProps:{sx:{borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(G,{onClick:te,children:"Print"}),e.jsx(G,{onClick:m,children:"View"}),e.jsxs(G,{onClick:le,children:[r.flagged?"Unflag":"Flag",r.flagged?e.jsx(ut,{fontSize:"small",sx:{ml:1}}):e.jsx(mt,{fontSize:"small",sx:{ml:1}})]}),e.jsx(G,{onClick:Q,children:"Edit"})]})]})]})}),e.jsx(he,{children:e.jsx(w,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(Ut,{in:N,timeout:"auto",unmountOnExit:!0,children:e.jsx(st,{children:N&&e.jsx(xe.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},children:e.jsxs(ua,{children:[e.jsx(ma,{variant:"h6",component:"div",children:"Detail"}),e.jsxs(ot,{size:"small","aria-label":"purchases",children:[e.jsx(it,{children:e.jsxs(he,{children:[e.jsx(w,{children:e.jsx("strong",{children:"Name"})}),e.jsx(w,{align:"right",children:e.jsx("strong",{children:"Quantity"})}),e.jsx(w,{align:"right",children:e.jsx("strong",{children:"Unit Price"})}),e.jsx(w,{align:"right",children:e.jsx("strong",{children:"Total Price"})})]})}),e.jsx(lt,{children:r.detail.map(f=>e.jsxs(rt,{children:[e.jsx(w,{component:"th",scope:"row",children:Y(f.name)}),e.jsx(w,{align:"right",children:f.quantity}),e.jsx(w,{align:"right",children:f.salesPrice}),e.jsx(w,{align:"right",children:qe(Math.ceil(f.salesPrice*f.quantity))})]},f.name))})]})]})})})})})})]})}ht.propTypes={row:ie.object.isRequired,onFlagChange:ie.func.isRequired};const me=L(w)(({theme:r})=>({[`&.${Pe.head}`]:{backgroundColor:"#262626",color:r.palette.primary.contrastText,fontSize:"16px",position:"sticky",top:0,zIndex:1},[`&.${Pe.body}`]:{fontSize:"14px"}}));L(he)(({theme:r})=>({"&:nth-of-type(odd)":{backgroundColor:r.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}));function xt({receipts:r,onFlagChange:y,searchTerm:T,setValue:N}){const[J,B]=i.useState(r);i.useEffect(()=>{let j=r;T&&(j=r.filter($=>{var v;return $.customerName.toLowerCase().includes(T.toLowerCase())||$.workerName.toLowerCase().includes(T.toLowerCase())||((v=$.customerCompany)==null?void 0:v.toLowerCase().includes(T.toLowerCase()))})),B(j.slice().reverse())},[T,r]);const A=(j,$)=>{B(v=>v.map(R=>R._id===j?{...R,flagged:$}:R)),y()};return e.jsx(Dt,{component:qt,className:"hide-scrollbar",sx:{maxHeight:"61vh"},children:e.jsxs(ot,{stickyHeader:!0,"aria-label":"collapsible table",children:[e.jsx(it,{children:e.jsxs(he,{children:[e.jsx(w,{}),e.jsx(me,{children:"Customer Name"}),e.jsx(me,{children:"Cashier"}),e.jsx(me,{align:"right",children:"Total"}),e.jsx(me,{align:"right",children:"Items Count"}),e.jsx(me,{align:"right",children:"Options"})]})}),e.jsx(lt,{children:J.map(j=>e.jsx(ht,{row:j,onFlagChange:A,setValue:N},j._id))})]})})}xt.propTypes={receipts:ie.array.isRequired,onFlagChange:ie.func.isRequired,searchTerm:ie.string.isRequired,setValue:ie.func.isRequired};const pa=Lt().shape({customerName:Ze().required("Customer name is required"),total:Ue().required(),amountPaid:Ue().required("Amount Paid should not be empty"),discount:Ue().min(0,"Discount cannot be negative"),paymentMethod:Ze().required("Payment method is required")}),ha=({customers:r,Products:y,handleCustomerUpdate:T,handleProductUpdate:N,editData:J})=>{const A=_t(),{row:j}=A.state||{},$=we(t=>t.userState.currentUser),v=$.id,R=we(t=>t.companyState.data),z=R.id,[ee,S]=i.useState(null),[b,E]=i.useState({}),[m,Q]=i.useState({}),[le,te]=i.useState(!1),[f,X]=i.useState(!1),[ae,re]=i.useState(!1),[ne,W]=i.useState(!1),[p,P]=i.useState(""),U=Je("(max-width:600px)");Je("(max-width:900px)");const[se,Ee]=i.useState(!1),bt=i.useRef(),[H,yt]=i.useState(null),jt=new Date().toLocaleDateString(),[Sa,ce]=i.useState(""),[Qe,q]=i.useState(!1),[vt,He]=i.useState(["<<<< Add New Customer >>>>",...r.sort().filter(t=>t!=="<<<< Add New Customer >>>>")]);i.useEffect(()=>{He(["<<<< Add New Customer >>>>",...r.sort().filter(t=>t!=="<<<< Add New Customer >>>>")])},[r]);const[oe,Se]=i.useState([{id:1,name:"<<<< Add New Product >>>>"},...y==null?void 0:y.sort((t,n)=>{var a;return(a=t.name)==null?void 0:a.localeCompare(n.name)})]);i.useEffect(()=>{Se([{id:1,name:"<<<< Add New Product >>>>"},...y==null?void 0:y.sort((t,n)=>{var a;return(a=t.name)==null?void 0:a.localeCompare(n.name)}).filter(t=>t!=="<<<< Add New Product >>>>")])},[y]);const[Ct,de]=i.useState(!1),[wt,be]=i.useState(!1),[ye,Ne]=i.useState(""),[je,$e]=i.useState(""),[M,Ke]=i.useState({name:"",salesPrice:"",costPrice:"",onhand:"",baseUnit:"none",allowsUnitBreakdown:!1,atomicUnit:"none",conversionFactor:1,potentialLoss:0}),Pt=()=>({customerName:"",products:[{name:"",quantity:"",unit:"none",totalPrice:0,price:0}],total:0,amountPaid:"",discount:0,paymentMethod:"cash"}),Ve=t=>{let n={};const a=t.products;return a&&a.forEach((l,x)=>{l.name||(n[`products.${x}.product`]=`Product ${x+1}'s name is required`),l.quantity||(n[`products.${x}.quantity`]=`Product ${x+1}'s quantity is required`),l.price||(n[`products.${x}.price`]=`Product ${x+1}'s price is required`)}),Q(n),n},St=async(t,n,a)=>{var o;const l=t.products.reduce((s,c)=>s+((c==null?void 0:c.totalPrice)||0),0);t.total=l;const x=t.total-t.amountPaid-t.discount;try{const s=Ve(t);if(Object.keys(s).length>0){S("Please fill in all required fields correctly.");return}if(!((o=t.customerName)!=null&&o.trim())){S("Customer Name should not be empty");return}if(t.amountPaid===void 0||t.amountPaid===""){S("Amount Paid should not be empty!");return}Ee(!0),n(!0);const c=await pe.addReceipt({...t,balance:x},z,v,!0);c.existingDebt?(te(!0),P(`Customer has an existing debt of ${c.existingDebt.amount}.`),X(!0)):(P("Receipt added successfully!"),X(!0));const d=zt(oe,t);Se(d),ae&&yt({...t,balance:x}),setTimeout(()=>{a()},1e3)}catch(s){S(s.message||"An error occurred")}finally{n(!1),Ee(!1)}},Nt=async()=>{try{if(q(!0),ce(""),!ye.trim()){ce("Customer name is required"),q(!1);return}const t=ye.trim().toLowerCase(),n={name:t,company:je.trim(),companyId:z},a=await pe.addCustomer(n);if(!a||typeof a!="object"){S(typeof a=="string"?a:"Failed to add customer"),q(!1);return}let l;a&&je.trim()?l=`${Y(je)} - ${Y(t)}`:l=`Nocompany - ${Y(t)}`,l&&l.trim()?(He(x=>{const o=x.filter(s=>s!=="<<<< Add New Customer >>>>"&&s!==l);return["<<<< Add New Customer >>>>",l,...o]}),T&&T(x=>{const o=x.filter(s=>s!=="<<<< Add New Customer >>>>"&&s!==l);return[l,...o]}),q(!1),de(!1),Ne(""),$e(""),ce("")):(console.warn("Customer created but display name formatting failed:",a),q(!1),de(!1),Ne(""),$e(""),ce(""))}catch(t){q(!1),t.response&&S(t.response.message||"Failed to add new customer"),console.error("Error adding new customer:",t),q(!1),ce(t.message||"Failed to add new customer")}},$t=async()=>{try{if(!Et(M,E))return;q(!0);const t=M.name.trim().toLowerCase(),n=await pe.addProduct({...M,name:t,companyId:z});if(!n){const x=typeof n=="string"?n:(n==null?void 0:n.message)||"Failed to add product";throw new Error(x)}const a=n,l={id:a.id,name:a.name,salesPrice:a.salesPrice||0,onhand:a.onhand||0,baseUnit:a.defaultUnit||"none"};Se(x=>{const o=x.filter(s=>s.name!=="<<<< Add New Product >>>>");return[{id:1,name:"<<<< Add New Product >>>>"},l,...o]}),N&&N(x=>{const o=x.filter(s=>s.name!=="<<<< Add New Product >>>>");return[l,...o]}),be(!1),q(!1),Ke({name:"",salesPrice:"",costPrice:"",onhand:"",baseUnit:"none",allowsUnitBreakdown:!1,atomicUnit:"none",conversionFactor:1,potentialLoss:0})}catch(t){q(!1),S(t.message||"Failed to add new product")}},K=t=>{const{name:n,value:a}=t.target;Ke(l=>({...l,[n]:a}))},Ye=t=>{if(!t)return["none"];const n=oe.find(l=>l.name.toLowerCase()===t.toLowerCase());if(!n)return["none"];const a=[n.baseUnit];return n.allowsUnitBreakdown&&n.atomicUnit!==n.baseUnit&&a.push(n.atomicUnit),n.conversions&&n.conversions.length>0&&n.conversions.forEach(l=>{a.includes(l.toUnit)||a.push(l.toUnit)}),a},Ge=(t,n,a)=>{var x;if(!a||!t||isNaN(t))return 0;if(!n||n==="none"){let o=1,s=a.atomicUnit||a.baseUnit;a.conversionFactor&&a.conversionFactor>o&&(o=a.conversionFactor,s=a.baseUnit),a.conversions&&a.conversions.forEach(c=>{c.factor&&c.factor>o&&(o=c.factor,s=c.toUnit)}),n=s}if(n===a.atomicUnit)return t;if(n===a.baseUnit&&a.conversionFactor)return t*a.conversionFactor;const l=(x=a.conversions)==null?void 0:x.find(o=>o.toUnit===n);return l&&l.factor?t*l.factor:t},ke=(t,n)=>{var x;const a=oe.find(o=>o.name.toLowerCase()===t.toLowerCase());if(!a)return 0;if(n===a.baseUnit)return a.salesPrice;const l=(x=a.conversions)==null?void 0:x.find(o=>o.toUnit===n);return l?l.salesPrice:a.salesPrice},kt=t=>{if(t==="")return!0;const n=parseFloat(t);return!isNaN(n)&&n>=0};return e.jsxs(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"page",children:[e.jsx("div",{className:"heading",style:{background:"none",marginBottom:"2rem"},children:e.jsxs(V,{variant:"h4",sx:{fontWeight:500,color:"#333",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("i",{className:"bx bx-cart-add",style:{fontSize:"2rem",color:"#2196f3"}}),"Make Sales"]})}),e.jsx(Jt,{initialValues:Pt(),validationSchema:pa,onSubmit:(t,{setSubmitting:n,resetForm:a})=>{St(t,n,a)},children:({values:t,submitForm:n,setFieldValue:a,isSubmitting:l,resetForm:x})=>e.jsxs(Xt,{className:"form",style:{margin:"1rem",padding:"2rem",background:"white",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[e.jsx(D,{name:"customerName",children:({field:o,form:s})=>{const c=!!(s.errors.customerName&&s.touched.customerName);return e.jsx(Oe,{...o,autoHighlight:!0,options:Y(vt),value:o.value,onChange:(d,u)=>{u==="<<<< Add New Customer >>>>"?(de(!0),s.setFieldValue(o.name,"")):s.setFieldValue(o.name,u||"")},renderInput:d=>e.jsx(C,{...d,style:{marginBottom:"1.5rem"},label:"Customer Name",fullWidth:!0,error:c,helperText:c?s.errors.customerName:"",variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})})}}),e.jsx("div",{style:{height:"2px",background:"linear-gradient(90deg, #2196f3, #f50057)",marginBottom:"2rem",borderRadius:"2px"}}),e.jsx(Zt,{name:"products",children:({push:o,remove:s})=>{var c;return e.jsxs("div",{style:{display:"flex",gap:"1rem",flexDirection:"column"},children:[(c=t.products)==null?void 0:c.map((d,u)=>{const Tt=oe.map(g=>(g==null?void 0:g.name)||"");return e.jsxs(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:u*.1},style:{display:"flex",flex:1,gap:"1rem",flexWrap:"wrap",flexDirection:U?"column":"row",padding:"1.5rem",background:"#f8f9fa",borderRadius:"12px",marginBottom:"1rem",border:"1px solid #e0e0e0"},children:[e.jsx("div",{style:{width:"100%"},children:e.jsx(D,{name:`products.${u}.name`,children:({field:g,form:O})=>e.jsx(Oe,{autoHighlight:!0,options:Tt,value:d.name?Y(d.name):"",onChange:(h,k)=>{if(k==="<<<< Add New Product >>>>")be(!0),O.setFieldValue(g.name,"");else if(O.setFieldValue(g.name,k||""),k){const F=oe.find(I=>I.name===k);if(F){a(`products.${u}.unit`,F.baseUnit);const I=d.quantity*F.salesPrice;a(`products.${u}.totalPrice`,Math.ceil(I)),a(`products.${u}.price`,F.salesPrice||0)}}},renderInput:h=>e.jsx(C,{...h,label:"Product Name",fullWidth:!0,error:!!(m!=null&&m[`products.${u}.product`]),helperText:(m==null?void 0:m[`products.${u}.product`])||"",variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})})})}),d.name&&e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:[e.jsx(V,{variant:"caption",color:"textSecondary",children:"Available Units:"}),Ye(d.name).map(g=>e.jsx(_,{size:"small",variant:"outlined",color:"primary",sx:{minWidth:"36px",height:"28px",padding:"0 8px"},onClick:()=>{a(`products.${u}.unit`,g);const O=ke(d.name,g);a(`products.${u}.price`,O);const h=Math.ceil(d.quantity*O);a(`products.${u}.totalPrice`,h)},children:g},g))]}),e.jsxs("div",{style:{display:"flex",gap:"0.8rem",flexWrap:"wrap",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:U?"1 1 100%":"2",minWidth:U?"100%":"200px"},children:[e.jsx(D,{name:`products.${u}.quantity`,children:({field:g,form:O})=>{const h=oe.find(F=>F.name===d.name),k=d.unit||(h==null?void 0:h.baseUnit)||"none";return e.jsx(C,{...g,label:"Quantity",type:"number",step:"any",error:!!(m!=null&&m[`products.${u}.quantity`]),helperText:(m==null?void 0:m[`products.${u}.quantity`])||"",onChange:F=>{const I=F.target.value;if(!kt(I)){Q(Te=>({...Te,[`products.${u}.quantity`]:"Quantity cannot be negative"}));return}const Z=parseFloat(I),ue=Ge(Z,k,h);if(h!=null&&h.allowsUnitBreakdown&&k===h.baseUnit&&ue%h.conversionFactor!==0&&(P(`Breaking down ${h.baseUnit} into ${h.atomicUnit} may result in potential loss of ${h.potentialLoss}%`),W(!0)),O.setFieldValue(g.name,Z),h){const Te=ke(d.name,k),Rt=Math.ceil(Z*Te);a(`products.${u}.totalPrice`,Rt)}},onBlur:F=>{const I=parseFloat(F.target.value);if(isNaN(I)){Q(ue=>({...ue,[`products.${u}.quantity`]:"Please enter a valid quantity"}));return}const Z=Ge(I,k,h);if(h&&Z>h.onhand&&(R==null?void 0:R.enableStockValidationNotification)!==!1){const ue=h.atomicUnit&&h.atomicUnit!=="none"?` ${h.atomicUnit}`:"";P(`Quantity cannot exceed available stock (${h.onhand}${ue})`),W(!0)}},variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})}}),e.jsx(D,{name:`products.${u}.unit`,children:({field:g,form:O})=>{const h=Ye(d.name);return e.jsx(Oe,{...g,options:h,value:g.value||"none",style:{flex:"1",minWidth:"80px"},renderInput:k=>e.jsx(C,{...k,label:"Unit",error:!!(m!=null&&m[`products.${u}.unit`]),helperText:(m==null?void 0:m[`products.${u}.unit`])||"",variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),onChange:(k,F)=>{O.setFieldValue(`products.${u}.unit`,F||"none");const I=ke(d.name,F);a(`products.${u}.price`,I);const Z=Math.ceil(d.quantity*I);a(`products.${u}.totalPrice`,Z)},freeSolo:!0,disableClearable:!0})}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.8rem",flex:U?"1 1 100%":"3",flexWrap:"wrap",alignItems:"center"},children:[e.jsx(D,{name:`products.${u}.price`,children:({field:g})=>e.jsx(C,{...g,label:"Price",type:"number",style:{flex:U?"1 1 calc(50% - 0.4rem)":"1",minWidth:"100px"},error:!!(m!=null&&m[`products.${u}.price`]),helperText:(m==null?void 0:m[`products.${u}.price`])||"",variant:"outlined",onChange:O=>{const h=parseFloat(O.target.value);a(`products.${u}.price`,h);const k=d.quantity*h;a(`products.${u}.totalPrice`,Math.ceil(k)),Ve(t)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})}),e.jsx(D,{name:`products.${u}.totalPrice`,children:({field:g})=>e.jsx(C,{...g,value:d.totalPrice,label:"Total Price",readOnly:!0,style:{flex:U?"1 1 calc(50% - 0.4rem)":"1",minWidth:"100px"},variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#f5f5f5"},"& .MuiInputLabel-root":{color:"#666"}}})}),e.jsx(_,{variant:"contained",color:"error",onClick:()=>s(u),sx:{borderRadius:"8px",textTransform:"none",height:"40px",minWidth:"100px"},children:"Remove"})]})]})]},u)}),e.jsxs(_,{variant:"contained",color:"secondary",type:"button",onClick:()=>{o({name:"",quantity:"",unit:"none",totalPrice:0,price:0})},disabled:t.products.length>0&&!Object.values(t.products[t.products.length-1]).every(Boolean),sx:{borderRadius:"8px",textTransform:"none",height:"45px",marginTop:"1rem"},children:[e.jsx("i",{className:"bx bx-plus",style:{marginRight:"8px"}}),"Add Product"]})]})}}),e.jsxs("div",{style:{marginTop:"2rem",padding:U?"1rem":"1.5rem",background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsx(V,{variant:"h6",sx:{color:"#333"},children:"Total"}),e.jsx(D,{name:"total",children:()=>{var o;return e.jsxs(V,{variant:"h6",sx:{color:"#2196f3"},children:["₵",(o=t.products)==null?void 0:o.reduce((s,c)=>s+((c==null?void 0:c.totalPrice)||0),0)]})}})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",marginBottom:"1rem"},children:[e.jsx(D,{name:"amountPaid",children:({field:o,form:s})=>{const c=!!(s.errors.amountPaid&&s.touched.amountPaid);return e.jsx(C,{...o,label:"Amount Paid",type:"number",placeholder:"Amount Paid",fullWidth:!0,error:c,helperText:c?s.errors.amountPaid:"",variant:"outlined",onChange:d=>{a("amountPaid",d.target.value||0)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})}}),e.jsx(D,{name:"discount",children:({field:o,form:s})=>{const c=!!(s.errors.discount&&s.touched.discount);return e.jsx(C,{...o,label:"Discount",type:"number",placeholder:"Discount",fullWidth:!0,error:c,helperText:c?s.errors.discount:"",variant:"outlined",onChange:d=>{a("discount",d.target.value)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"},"& .MuiInputLabel-root":{color:"#666"}}})}}),e.jsx(D,{name:"paymentMethod",children:({field:o,form:s})=>{const c=!!(s.errors.paymentMethod&&s.touched.paymentMethod);return e.jsxs(At,{fullWidth:!0,error:c,variant:"outlined",children:[e.jsx(Wt,{children:"Payment Method"}),e.jsxs(Bt,{...o,label:"Payment Method",value:o.value||"cash",onChange:d=>{a("paymentMethod",d.target.value)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}},children:[e.jsx(G,{value:"cash",children:"Cash"}),e.jsx(G,{value:"card",children:"Card"}),e.jsx(G,{value:"mobile_money",children:"Mobile Money"}),e.jsx(G,{value:"bank_transfer",children:"Bank Transfer"})]}),c&&e.jsx(V,{variant:"caption",color:"error",sx:{mt:.5},children:s.errors.paymentMethod})]})}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",background:"white",borderRadius:"8px",border:"1px solid #e0e0e0",width:"75%"},children:[e.jsx(V,{variant:"h6",sx:{color:"#333"},children:"Balance"}),e.jsx(D,{name:"balance",children:()=>{var o,s;return e.jsx(V,{variant:"h6",sx:{color:((o=t.products)==null?void 0:o.reduce((c,d)=>c+((d==null?void 0:d.totalPrice)||0),0))-t.amountPaid-t.discount>0?"#f44336":"#4caf50",fontWeight:600},children:((s=t.products)==null?void 0:s.reduce((c,d)=>c+((d==null?void 0:d.totalPrice)||0),0))-t.amountPaid-t.discount})}})]})]}),e.jsxs("div",{style:{position:"fixed",bottom:"2rem",right:"2rem",display:"flex",gap:"1rem",zIndex:1e3,background:"white",padding:"1rem",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsx(_,{variant:"contained",color:"primary",onClick:()=>{re(!0),n()},disabled:se||l,sx:{borderRadius:"8px",textTransform:"none",height:"45px",minWidth:"150px"},children:se?e.jsx(Xe,{size:24}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bx bx-printer",style:{marginRight:"8px"}}),"Save and Print"]})}),e.jsx(_,{variant:"contained",color:"success",onClick:()=>{n()},disabled:se||l,sx:{borderRadius:"8px",textTransform:"none",height:"45px",minWidth:"120px"},children:se?e.jsx(Xe,{size:24}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bx bx-save",style:{marginRight:"8px"}}),"Save"]})})]})]})}),ee&&e.jsx(Vt,{error:ee,onClose:()=>S(null)}),e.jsx(ea,{sx:{"& .MuiSnackbarContent-root":{color:le?"red":"white"}},open:f,autoHideDuration:5e3,onClose:()=>X(!1),message:p||"Sales successfully Recorded",anchorOrigin:{vertical:"top",horizontal:"center"}}),e.jsxs(Fe,{open:ne,onClose:()=>W(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Me,{id:"alert-dialog-title",children:"Insufficient Inventory"}),e.jsx(ve,{children:e.jsx(Ce,{id:"alert-dialog-description",children:p})}),e.jsx(Ie,{children:e.jsx(_,{autoFocus:!0,onClick:()=>W(!1),color:"primary",children:"OK"})})]}),e.jsxs(Fe,{open:Ct,onClose:()=>de(!1),"aria-labelledby":"new-customer-dialog-title","aria-describedby":"new-customer-dialog-description",children:[e.jsx(Me,{id:"new-customer-dialog-title",children:"Add New Customer"}),Qe?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",width:316,height:300},children:e.jsx(_e,{type:3})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{id:"new-customer-dialog-description",children:"Enter the name of the new customer:"}),e.jsx(C,{autoFocus:!0,margin:"dense",id:"new-customer-name",label:"Customer Name",type:"text",fullWidth:!0,variant:"standard",value:ye,onChange:t=>Ne(t.target.value.toLowerCase())})]}),e.jsxs(ve,{children:[e.jsx(Ce,{id:"new-customer-dialog-description",children:"Enter Company Name:"}),e.jsx(C,{autoFocus:!0,margin:"dense",id:"new-customer-company",label:"Company Name",type:"text",fullWidth:!0,variant:"standard",value:je,onChange:t=>$e(t.target.value.toLowerCase())})]}),e.jsxs(Ie,{children:[e.jsx(_,{onClick:()=>de(!1),color:"primary",children:"Cancel"}),ye&&e.jsx(_,{onClick:Nt,color:"primary",children:"Add"})]})]})]}),e.jsxs(Fe,{open:wt,onClose:()=>be(!1),children:[e.jsx(Me,{children:"Add New Product"}),Qe?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",width:600,height:316},children:e.jsx(_e,{type:3})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{children:"Please enter the details of the new product."}),e.jsx(C,{autoFocus:!0,margin:"dense",label:"Product Name",name:"name",fullWidth:!0,required:!0,value:M.name,onChange:K,error:!!b.name,helperText:b.name}),e.jsx(C,{margin:"dense",label:"Sales Price",type:"number",name:"salesPrice",fullWidth:!0,required:!0,value:M.salesPrice,onChange:K,error:!!b.salesPrice,helperText:b.salesPrice}),e.jsx(C,{margin:"dense",label:"Cost Price",type:"number",name:"costPrice",fullWidth:!0,required:!0,value:M.costPrice,onChange:K,error:!!b.costPrice,helperText:b.costPrice}),e.jsx(C,{margin:"dense",label:"Available Quantity",type:"number",name:"onhand",fullWidth:!0,required:!0,value:M.onhand,onChange:K,error:!!b.onhand,helperText:b.onhand}),e.jsx(C,{margin:"dense",label:"Base Unit (e.g., box, carton)",name:"baseUnit",fullWidth:!0,required:!0,value:M.baseUnit,onChange:K,error:!!b.baseUnit,helperText:b.baseUnit||"Primary unit for wholesale sales"}),M.allowsUnitBreakdown&&e.jsxs(e.Fragment,{children:[e.jsx(C,{margin:"dense",label:"Atomic Unit (e.g., piece, bottle)",name:"atomicUnit",fullWidth:!0,value:M.atomicUnit,onChange:K,error:!!b.atomicUnit,helperText:b.atomicUnit||"Smallest unit for retail sales"}),e.jsx(C,{margin:"dense",label:"Conversion Factor",type:"number",name:"conversionFactor",fullWidth:!0,value:M.conversionFactor,onChange:K,error:!!b.conversionFactor,helperText:b.conversionFactor||"How many atomic units in one base unit"}),e.jsx(C,{margin:"dense",label:"Potential Loss (%)",type:"number",name:"potentialLoss",fullWidth:!0,value:M.potentialLoss,onChange:K,error:!!b.potentialLoss,helperText:b.potentialLoss||"Estimated loss when breaking down units"})]})]}),e.jsxs(Ie,{children:[e.jsx(_,{onClick:()=>be(!1),color:"primary",children:"Cancel"}),e.jsx(_,{onClick:$t,color:"primary",children:"Add Product"})]})]})]}),H&&e.jsx("div",{style:{display:"none"},children:e.jsx(dt,{ref:bt,customerName:H.customerName,customerCompany:H.customerCompany,products:H.products,total:H.total,balance:H.balance,amountPaid:H.amountPaid,discount:H.discount,date:jt,workerName:$.username?$.username:$.name})})]})};var Be={},xa=fe;Object.defineProperty(Be,"__esModule",{value:!0});var ft=Be.default=void 0,fa=xa(ge()),ga=e;ft=Be.default=(0,fa.default)((0,ga.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList");var ze={},ba=fe;Object.defineProperty(ze,"__esModule",{value:!0});var gt=ze.default=void 0,ya=ba(ge()),ja=e;gt=ze.default=(0,ya.default)((0,ja.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const va=L(xe.div)(({theme:r})=>({display:"flex",width:"100%",flexWrap:"wrap",flexDirection:"row-reverse",alignItems:"flex-end",justifyContent:"space-between",marginBottom:"20px",gap:"16px"})),Ca=L(xe.div)(({theme:r})=>({display:"flex",gap:"16px",alignItems:"center",padding:"16px",background:"white",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"all 0.3s ease-in-out","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.1)"}})),wa=L("input")(({theme:r})=>({padding:"8px 12px",borderRadius:"8px",border:"1px solid #e0e0e0",fontSize:"14px",transition:"all 0.2s ease-in-out","&:focus":{outline:"none",borderColor:"#1a237e",boxShadow:"0 0 0 2px rgba(26, 35, 126, 0.1)"}})),Pa=L(De)(({theme:r})=>({background:"white",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"all 0.2s ease-in-out","&:hover":{background:"#f5f5f5",transform:"scale(1.05)"}})),Ea=()=>{const r=we(p=>p.companyState.data.id),[y,T]=i.useState([]),[N,J]=i.useState(0),[B,A]=i.useState([]),[j,$]=i.useState(new Date),[v,R]=i.useState(""),[z,ee]=i.useState(0),[S,b]=i.useState(!1);i.useEffect(()=>{(async()=>{const P=await pe.fetchCustomersNames(r);T(P)})()},[r]),i.useEffect(()=>{(async()=>{const P=await pe.fetchProductNames(r);A(P)})()},[r]);const E=async()=>{try{const p=j.toISOString().split("T")[0];return(await ct.get(`/api/receipts/${r}?date=${p}`)).data}catch(p){throw console.error("Error fetching receipts:",p),p}},{data:m,isLoading:Q,isError:le,refetch:te}=Qt(["receipts",r,j],E,{refetchOnWindowFocus:!0,enabled:N===0}),f=p=>{if(p){const P=p.filter(U=>!U.flagged).reduce((U,se)=>U+se.total,0);ee(P)}};i.useEffect(()=>{f(m)},[m]);const X=(p,P)=>{J(P),P===0&&te()},ae=p=>{R(p)},re=()=>{b(p=>!p)},ne=p=>{T(p)},W=p=>{A(p)};return Q?e.jsx(_e,{}):e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"heading",children:[e.jsx("div",{children:e.jsx("h1",{style:{fontWeight:200},children:"Sales"})}),e.jsx("div",{style:{width:"40%"},children:e.jsxs(Ht,{value:N,onChange:X,indicatorColor:"secondary",textColor:"inherit",variant:"fullWidth","aria-label":"full width tabs example",children:[e.jsx(et,{label:"Sales",...tt(0)}),e.jsx(et,{label:"Make Sales",...tt(1)})]})}),e.jsx("div",{className:"dot",style:{paddingRight:4},children:"."})]}),e.jsx(at,{value:N,index:0,children:e.jsxs("div",{className:"content",children:[e.jsxs(va,{children:[e.jsx(Yt,{title:"Sales",count:`₵${qe(z)}`}),e.jsx(st,{children:S&&e.jsxs(Ca,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2,ease:"easeInOut"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ta,{color:"action"}),e.jsx(wa,{type:"date",value:j.toISOString().split("T")[0],onChange:p=>$(new Date(p.target.value))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(gt,{color:"action"}),e.jsx(Gt,{onSearch:ae,placeholder:"Search Customer Name"})]})]})}),e.jsx(nt,{title:S?"Hide Filters":"Show Filters",children:e.jsx(Pa,{onClick:re,children:e.jsx(ft,{color:S?"primary":"action"})})})]}),!Q&&!le&&m&&m.length>0?e.jsx("div",{style:{width:"100%"},children:e.jsx(xt,{receipts:m,searchTerm:v,onFlagChange:te,setValue:J})}):e.jsx("div",{children:j.toISOString().split("T")[0]===new Date().toISOString().split("T")[0]?e.jsx("h2",{style:{paddingTop:"50%"},children:"No Sales Made Today"}):e.jsxs("h2",{style:{paddingTop:"50%"},children:["No Sales Made on ",j.toISOString().split("T")[0]]})})]})}),e.jsx(at,{value:N,index:1,children:e.jsx(ha,{customers:y,Products:B,handleCustomerUpdate:ne,handleProductUpdate:W})})]})};export{Ea as default};
