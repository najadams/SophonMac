import{a4 as X,j as e,r as M,U as O,R as se,Q as ie,ap as H,a1 as le,C as oe,aq as Q,B as i,T as s,ar as Y,H as j,G as n,b as d,as as ce,at as y,au as K,ah as A,ai as W,ab as B,q as u,af as de,av as me,c as P,aw as Z,a3 as D,$ as v,J as $,F as ue}from"./index-DKVd45z4.js";import{F as xe,a as he,b as pe}from"./formik.esm-CSF9_jiQ.js";import{S as J,a as k}from"./Settings-DkAUG6Tw.js";import{Z as be,B as je,L as ye}from"./LocalOffer-DULQd6_X.js";import{s as z,P as ge}from"./styled-BV1I2k5G.js";import{S as g}from"./Slide-RKfJso1_.js";import{N as fe}from"./Notifications-Cd-zamdm.js";import{P as T}from"./People-BHgavFBj.js";import{S as Se}from"./Snackbar-DQl3JBex.js";const we=X([e.jsx("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),e.jsx("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong"),Ce=X(e.jsx("path",{d:"M20 4H4v2h16zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6zm-9 4H6v-4h6z"}),"Store");class ve extends M.Component{constructor(c){super(c),this.state={hasError:!1,error:null}}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,x){console.error("ErrorBoundary caught an error",c,x)}render(){return this.state.hasError?e.jsx("h1",{children:"Something went wrong. Please try again later."}):this.props.children}}const m=z(pe)({margin:"10px 0",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)"}}),f=z(ue)(({theme:t})=>({transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-5px)",boxShadow:t.shadows[8]}})),ke=z(P)(({theme:t})=>({transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:t.shadows[4]}})),ze=()=>{const t=O(a=>a.companyState.data),c=O(a=>a.companyState.data.id),x=O(a=>a.userState.currentUser),[ee,h]=M.useState(!1),[te,p]=M.useState(""),w=se(),N=ie(),[L,q]=M.useState(""),[E,V]=M.useState(""),[Me,Pe]=M.useState(""),[Re,De]=M.useState(["cash","card","mobile_money","bank_transfer","check"]),G=(x==null?void 0:x.role)===H.SUPER_ADMIN||(x==null?void 0:x.role)===H.STORE_MANAGER,ae=G,_=G||(x==null?void 0:x.role)===H.IT_SUPPORT,{data:Te,isLoading:Ie,error:Ne}=le(["api/workers",c],()=>D.fetchWorkers(c)),ne=(a,r)=>{const{name:C,value:R}=a.target;r(C,Y(R))},re=()=>{h(!1),p("")};return e.jsx(ve,{children:e.jsxs("div",{className:"page",children:[e.jsxs(oe,{maxWidth:"md",children:[e.jsx(Q,{in:!0,timeout:1e3,children:e.jsxs(i,{display:"flex",alignItems:"center",mb:4,children:[e.jsx(J,{sx:{fontSize:40,mr:2,color:"primary.main"}}),e.jsxs(i,{children:[e.jsx(s,{variant:"h4",component:"h1",sx:{fontWeight:"bold"},children:"Settings"}),e.jsx(s,{variant:"subtitle1",color:"text.secondary",children:"Configure your POS system preferences"})]})]})}),e.jsx(xe,{initialValues:{companyName:Y(t.companyName)||"",email:t.email||"",contact:t.contact||"",momo:t.momo||"",address:t.address||"",paymentMethod:"",location:t.location||"",paymentProvider:"",currency:"cedis  â‚µ",tinNumber:t.tinNumber||"",taxRate:t.taxRate||"",taxId:t.taxId||"",emailNotifications:t.emailNotifications||!0,smsNotifications:t.smsNotifications||!1,currentPlan:t.currentPlan||"Standard",nextBillingDate:t.nextBillingDate||"2024-06-15",receiptHeader:t.receiptHeader||"",receiptFooter:t.receiptFooter||"",defaultPrinter:t.defaultPrinter||"",receiptWidth:t.receiptWidth||"80mm",enableBarcode:t.enableBarcode||!0,enableStockAlerts:t.enableStockAlerts||!0,lowStockThreshold:t.lowStockThreshold||10,enableCustomerLoyalty:t.enableCustomerLoyalty||!1,loyaltyPointsRate:t.loyaltyPointsRate||1,enableDiscounts:t.enableDiscounts||!0,defaultTaxRate:t.defaultTaxRate||12.5,enableMultipleTaxRates:t.enableMultipleTaxRates||!1,enableCashDrawer:t.enableCashDrawer||!1,cashDrawerPort:t.cashDrawerPort||"",backupFrequency:t.backupFrequency||"daily",enableAutoBackup:t.enableAutoBackup||!0,enableOfflineMode:t.enableOfflineMode||!0,enableCustomerManagement:t.enableCustomerManagement||!0,enableSupplierManagement:t.enableSupplierManagement||!0,enableInventoryTracking:t.enableInventoryTracking||!0,enablePurchaseOrders:t.enablePurchaseOrders||!0,enableSalesReturns:t.enableSalesReturns||!0,enableStockTransfers:t.enableStockTransfers||!0,enablePriceHistory:t.enablePriceHistory||!0,enableBulkOperations:t.enableBulkOperations||!0,enableReports:t.enableReports||!0,enableAnalytics:t.enableAnalytics||!0,enableMultiCurrency:t.enableMultiCurrency||!1,defaultCurrency:t.defaultCurrency||"GHS",enableExchangeRates:t.enableExchangeRates||!1,enablePaymentMethods:t.enablePaymentMethods||!0,defaultPaymentMethod:t.defaultPaymentMethod||"cash",enableSplitPayments:t.enableSplitPayments||!0,enablePartialPayments:t.enablePartialPayments||!0,enableHoldOrders:t.enableHoldOrders||!0,enableTableManagement:t.enableTableManagement||!1,enableKitchenDisplay:t.enableKitchenDisplay||!1,enableEmployeeTimeTracking:t.enableEmployeeTimeTracking||!0,enableEmployeeCommission:t.enableEmployeeCommission||!1,commissionRate:t.commissionRate||0,enableShiftManagement:t.enableShiftManagement||!0,enableCashManagement:t.enableCashManagement||!0,enableBankReconciliation:t.enableBankReconciliation||!0,enableAuditLogs:t.enableAuditLogs||!0,enableUserActivityLogs:t.enableUserActivityLogs||!0,enableSystemLogs:t.enableSystemLogs||!0,enableSecurityLogs:t.enableSecurityLogs||!0,enableDataExport:t.enableDataExport||!0,enableDataImport:t.enableDataImport||!0,enableDataBackup:t.enableDataBackup||!0,enableDataRestore:t.enableDataRestore||!0,enableSystemUpdates:t.enableSystemUpdates||!0,enableSystemMaintenance:t.enableSystemMaintenance||!0,enableSystemDiagnostics:t.enableSystemDiagnostics||!0,enableSystemOptimization:t.enableSystemOptimization||!0,enableSystemSecurity:t.enableSystemSecurity||!0,enableSystemMonitoring:t.enableSystemMonitoring||!0,enableSystemAlerts:t.enableSystemAlerts||!0,enableSystemReports:t.enableSystemReports||!0,enableSystemAnalytics:t.enableSystemAnalytics||!0,enableSystemBackup:t.enableSystemBackup||!0,enableSystemRestore:t.enableSystemRestore||!0,receiptTemplate:t.receiptTemplate||"template1",allowedUnits:t.allowedUnits||[],allowedCategories:t.allowedCategories||[],enableStockValidationNotification:t.enableStockValidationNotification!==void 0?t.enableStockValidationNotification:!0},onSubmit:async(a,{setSubmitting:r,setErrors:C})=>{var I;r(!0);const R={...a,companyName:a.companyName.trim().toLowerCase(),email:a.email.trim().toLowerCase(),contact:a.contact.trim(),momo:a.momo.trim().toLowerCase(),address:a.address.trim().toLowerCase()};try{const S={companyId:c,...R};await D.updateCompanyData(S),w(v.fetchCompanySuccess({id:c,...S})),p("Company details updated successfully!"),h(!0)}catch(S){console.error(S),C({submit:((I=S==null?void 0:S.message)==null?void 0:I.data)||"Failed to update company details. Please try again."}),p("Failed to update company details. Please try again."),h(!0)}r(!1)},children:({values:a,handleChange:r,setFieldValue:C,errors:R})=>{var I,S;return e.jsxs(he,{children:[e.jsx(be,{in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(Ce,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"General Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"companyName",label:"Store Name",variant:"outlined",value:a.companyName,onChange:r,onBlur:l=>ne(l,C)})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"email",label:"Store Email",variant:"outlined",value:a.email,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"contact",label:"Store Phone",variant:"outlined",value:a.contact,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"momo",label:"Momo Number",variant:"outlined",value:a.momo,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"address",label:"Store Digital Address",variant:"outlined",value:a.address,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,name:"location",label:"Store Location",variant:"outlined",value:a.location,onChange:r})})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(ce,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Tax Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:4,children:e.jsx(m,{as:d,fullWidth:!0,name:"tinNumber",label:"Tin Number",variant:"outlined",value:a.tinNumber,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsx(m,{as:d,fullWidth:!0,name:"taxRate",label:"Tax Rate (%)",variant:"outlined",value:a.taxRate,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsx(m,{as:d,fullWidth:!0,name:"taxId",label:"Tax ID",variant:"outlined",value:a.taxId,onChange:r})})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(fe,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Notification Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(K,{name:"emailNotifications",checked:a.emailNotifications,onChange:r,color:"primary"}),label:"Email Notifications"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(K,{name:"smsNotifications",checked:a.smsNotifications,onChange:r,color:"primary"}),label:"SMS Notifications"})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(y,{control:e.jsx(k,{name:"enableStockValidationNotification",checked:a.enableStockValidationNotification,onChange:r,color:"primary"}),label:"Enable Stock Validation Notifications"}),e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Show notifications when sales quantity exceeds available stock"})]})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(we,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Receipt Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(A,{fullWidth:!0,children:[e.jsx(W,{children:"Receipt Template"}),e.jsxs(B,{name:"receiptTemplate",value:a.receiptTemplate,onChange:r,label:"Receipt Template",children:[e.jsx(u,{value:"template1",children:e.jsxs(i,{children:[e.jsx(s,{variant:"subtitle1",children:"Template 1"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Standard receipt with logo and footer"})]})}),e.jsx(u,{value:"template2",children:e.jsxs(i,{children:[e.jsx(s,{variant:"subtitle1",children:"Template 2"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Compact receipt with QR code"})]})}),e.jsx(u,{value:"template3",children:e.jsxs(i,{children:[e.jsx(s,{variant:"subtitle1",children:"Template 3"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Detailed receipt with tax breakdown"})]})})]})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(m,{as:d,fullWidth:!0,multiline:!0,rows:2,name:"receiptHeader",label:"Receipt Header",variant:"outlined",value:a.receiptHeader,onChange:r})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(m,{as:d,fullWidth:!0,multiline:!0,rows:2,name:"receiptFooter",label:"Receipt Footer",variant:"outlined",value:a.receiptFooter,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(A,{fullWidth:!0,children:[e.jsx(W,{children:"Default Printer"}),e.jsxs(B,{name:"defaultPrinter",value:a.defaultPrinter,onChange:r,label:"Default Printer",children:[e.jsx(u,{value:"thermal",children:"Thermal Printer"}),e.jsx(u,{value:"dot-matrix",children:"Dot Matrix"}),e.jsx(u,{value:"laser",children:"Laser Printer"})]})]})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(A,{fullWidth:!0,children:[e.jsx(W,{children:"Receipt Width"}),e.jsxs(B,{name:"receiptWidth",value:a.receiptWidth,onChange:r,label:"Receipt Width",children:[e.jsx(u,{value:"58mm",children:"58mm"}),e.jsx(u,{value:"80mm",children:"80mm"}),e.jsx(u,{value:"112mm",children:"112mm"})]})]})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableBarcode",checked:a.enableBarcode,onChange:r}),label:"Enable Barcode Scanning"})})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(de,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Inventory Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableStockAlerts",checked:a.enableStockAlerts,onChange:r}),label:"Enable Stock Alerts"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,type:"number",name:"lowStockThreshold",label:"Low Stock Threshold",variant:"outlined",value:a.lowStockThreshold,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableCustomerLoyalty",checked:a.enableCustomerLoyalty,onChange:r}),label:"Enable Customer Loyalty Program"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,type:"number",name:"loyaltyPointsRate",label:"Loyalty Points Rate",variant:"outlined",value:a.loyaltyPointsRate,onChange:r})})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(me,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Payment Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableDiscounts",checked:a.enableDiscounts,onChange:r}),label:"Enable Discounts"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(m,{as:d,fullWidth:!0,type:"number",name:"defaultTaxRate",label:"Default Tax Rate (%)",variant:"outlined",value:a.defaultTaxRate,onChange:r})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableMultipleTaxRates",checked:a.enableMultipleTaxRates,onChange:r}),label:"Enable Multiple Tax Rates"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableCashDrawer",checked:a.enableCashDrawer,onChange:r}),label:"Enable Cash Drawer"})})]})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(je,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Backup & Security"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsxs(A,{fullWidth:!0,children:[e.jsx(W,{children:"Backup Frequency"}),e.jsxs(B,{name:"backupFrequency",value:a.backupFrequency,onChange:r,label:"Backup Frequency",children:[e.jsx(u,{value:"daily",children:"Daily"}),e.jsx(u,{value:"weekly",children:"Weekly"}),e.jsx(u,{value:"monthly",children:"Monthly"})]})]})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableAutoBackup",checked:a.enableAutoBackup,onChange:r}),label:"Enable Auto Backup"})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(y,{control:e.jsx(k,{name:"enableOfflineMode",checked:a.enableOfflineMode,onChange:r}),label:"Enable Offline Mode"})})]})]})})}),ae&&e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(T,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Employee Management"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(P,{variant:"contained",color:"primary",startIcon:e.jsx(ge,{}),onClick:()=>N("/employee/new"),fullWidth:!0,children:"Add New Employee"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(P,{variant:"outlined",color:"primary",startIcon:e.jsx(T,{}),onClick:()=>N("/employees"),fullWidth:!0,children:"Manage Employees"})})]})]})})}),_&&e.jsxs(e.Fragment,{children:[e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(T,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Customer Management"})]}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsx(P,{variant:"outlined",color:"primary",startIcon:e.jsx(T,{}),onClick:()=>N("/customers"),fullWidth:!0,children:"Manage Customers"})})})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(T,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Supplier Management"})]}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsx(P,{variant:"outlined",color:"primary",startIcon:e.jsx(T,{}),onClick:()=>N("/suppliers"),fullWidth:!0,children:"Manage Suppliers"})})})]})})}),e.jsx(g,{direction:"up",in:!0,timeout:800,children:e.jsx(f,{sx:{mb:4},children:e.jsxs(j,{children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(ye,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",children:"Product Settings"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Allowed Units"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(d,{size:"small",value:L,onChange:l=>q(l.target.value),placeholder:"Add new unit",fullWidth:!0}),e.jsx(P,{variant:"contained",onClick:async()=>{if(L.trim()){const l=L.trim().toLowerCase(),b=[...a.allowedUnits||[],l];C("allowedUnits",b),q("");try{const o={companyId:c,allowedUnits:b,allowedCategories:a.allowedCategories||[]};await D.updateCompanyData(o),w(v.addAllowedUnit(l)),w(v.fetchCompanySuccess({id:c,...t,allowedUnits:b})),p("Units updated successfully!"),h(!0)}catch(o){console.error(o),p("Failed to update units. Please try again."),h(!0)}}},children:e.jsx(Z,{})})]}),e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(I=a.allowedUnits)==null?void 0:I.map((l,b)=>e.jsx($,{label:l,onDelete:async()=>{try{const o=a.allowedUnits.filter(F=>F!==l);C("allowedUnits",o);const U={companyId:c,allowedUnits:o,allowedCategories:a.allowedCategories||[]};await D.updateCompanyData(U),w(v.removeAllowedUnit(l)),w(v.fetchCompanySuccess({id:c,...t,allowedUnits:o})),p("Unit removed successfully!"),h(!0)}catch(o){console.error(o),p("Failed to remove unit. Please try again."),h(!0)}}},b))})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Allowed Categories"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(d,{size:"small",value:E,onChange:l=>V(l.target.value),placeholder:"Add new category",fullWidth:!0}),e.jsx(P,{variant:"contained",onClick:async()=>{if(E.trim()){const l=E.trim().toLowerCase(),b=[...a.allowedCategories||[],l];C("allowedCategories",b),V("");try{const o={companyId:c,allowedUnits:a.allowedUnits||[],allowedCategories:b};await D.updateCompanyData(o),w(v.addAllowedCategory(l)),w(v.fetchCompanySuccess({id:c,...t,allowedCategories:b})),p("Categories updated successfully!"),h(!0)}catch(o){console.error(o),p("Failed to update categories. Please try again."),h(!0)}}},children:e.jsx(Z,{})})]}),e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(S=a.allowedCategories)==null?void 0:S.map((l,b)=>e.jsx($,{label:l,onDelete:async()=>{try{const o=a.allowedCategories.filter(F=>F!==l);C("allowedCategories",o);const U={companyId:c,allowedUnits:a.allowedUnits||[],allowedCategories:o};await D.updateCompanyData(U),w(v.removeAllowedCategory(l)),w(v.fetchCompanySuccess({id:c,...t,allowedCategories:o})),p("Category removed successfully!"),h(!0)}catch(o){console.error(o),p("Failed to remove category. Please try again."),h(!0)}}},b))})]})]})]})})})]}),e.jsx(Q,{in:!0,timeout:1e3,children:e.jsxs(i,{mt:3,children:[e.jsx(ke,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,size:"large",startIcon:e.jsx(J,{}),disabled:!_,children:"Save Changes"}),R.submit&&e.jsx(s,{color:"error",variant:"body2",sx:{mt:1},children:R.submit})]})})]})}})]}),e.jsx(Se,{open:ee,autoHideDuration:2e3,onClose:re,message:te,anchorOrigin:{vertical:"top",horizontal:"center"},TransitionComponent:g})]})})};export{ze as default};
